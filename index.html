<!DOCTYPE html>
<html>
	<meta charset="UTF-8">
	<head>
		<title>Testing</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body style="height: 100vh; width:100vw; position: fixed;">
		<script src="blockly/blockly_compressed.js"></script>
		<script src="blockly/javascript_compressed.js"></script>

		<script src="blockly/blocks_compressed.js"></script>
		<script src="blockly/msg/js/en.js"></script>
		<script src="Scripts/main.js"></script>

		<h1 style="height: 2%; position: relative; top: 0px;"> Testing </h1>

		<div id="blocklyDiv" style="height: 90%; width: 60%; float:left;"></div>

		<div id="codeDiv" style="height: 90%; width: 20%; border-color: black; margin-left: 60%; text-align: center;">

		</div>

		<button onclick="codeViewer()" style="bottom: 0"> view code </button>
		<button onclick="executeCode()" style="bottom: 0"> run code </button>

		<xml id="toolbox" style="display: none">
			<category name="Control">
			  <block type="blank"></block>
			  <block type="blank"></block>
			</category>

			<category name="logical operators">
				<block type="blank"></block>
			</category>

			<category name="Maths">
			  <block type="math_arithmetic"></block>
			  <block type="math_number"></block>
			</category>

			<category name="movement">
				<block type="text"></block>
			  <block type="text_print"></block>
			</category>

		</xml>
	</body>

	<script>
		var workspace = Blockly.inject('blocklyDiv',
			{toolbox: document.getElementById('toolbox'),
			 grid:
					{
						spacing:15,
						length:4,
						colour:'#ccc',
						snap:true
					}
		});

		function codeViewer() { // viewer for the code produced
		  var code = Blockly.JavaScript.workspaceToCode(workspace);
		  document.getElementById('codeDiv').innerHTML = code;
		}

		// function codeParse(obj){
		// 	return Function(obj)
		// }

		function executeCode() {
			window.LoopTrap = 100;
			Blockly.JavaScript.INFINITE_LOOP_TRAP = 'if(--window.LoopTrap == 0) throw "Infinite loop.";\n';
			var code = Blockly.JavaScript.workspaceToCode(workspace);
			try{
				eval(code);
			}
			catch (e){
				alert(e);
			}
		}

		Blockly.JavaScript.addReservedWords('code'); //make code a reserved word

	</script>
</html>
